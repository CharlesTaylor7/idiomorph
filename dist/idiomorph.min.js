(function(e,t){if(typeof define==="function"&&define.amd){define([],t)}else{e.Idiomorph=e.Idiomorph||t()}})(typeof self!=="undefined"?self:this,function(){return function(){"use strict";let i=new Set;function e(r,e,t={}){if(typeof e==="string"){e=b(e)}let o=g(e);let i=l(r,o,t);if(t.morphStyle==="innerHTML"){n(o,r,i);return r.children}else if(t.morphStyle==="outerHTML"||t.morphStyle==null){let e=N(o,r,i);let t=e?.previousSibling;let l=e?.nextSibling;let n=d(r,e,i);if(e){return v(t,n,l)}else{return[]}}else{throw"Do not understand how to morph style "+t.morphStyle}}function d(e,t,l){if(t==null){l.callbacks.beforeNodeRemoved(e);e.remove();l.callbacks.afterNodeRemoved(e);return null}else if(!s(e,t)){l.callbacks.beforeNodeRemoved(e);l.callbacks.beforeNodeAdded(t);e.parentElement.replaceChild(t,e);l.callbacks.afterNodeAdded(t);l.callbacks.afterNodeRemoved(e);return t}else{l.callbacks.beforeNodeMorphed(e,t);if(e instanceof HTMLHeadElement&&l.head.strategy!=="morph"){o(t,e,l)}else{r(t,e);n(t,e,l)}l.callbacks.afterNodeMorphed(e,t);return e}}function n(l,n,r){let e=l.firstChild;let o=n.firstChild;while(e){let t=e;e=t.nextSibling;if(o==null){r.callbacks.beforeNodeAdded(t);n.appendChild(t);r.callbacks.afterNodeAdded(t)}else if(u(t,o,r)){d(o,t,r);o=o.nextSibling}else{let e=p(l,n,t,o,r);if(e){o=c(o,e,r);d(e,t,r)}else{let e=m(l,n,t,o,r);if(e){o=c(o,e,r);d(e,t,r)}else{r.callbacks.beforeNodeAdded(t);n.insertBefore(t,o);r.callbacks.afterNodeAdded(t)}}}k(r,t)}while(o!==null){let e=o;o=o.nextSibling;y(e,r)}}function r(l,n){let e=l.nodeType;if(e===1){const t=l.attributes;const r=n.attributes;for(const o of t){if(n.getAttribute(o.name)!==o.value){n.setAttribute(o.name,o.value)}}for(const i of r){if(!l.hasAttribute(i.name)){n.removeAttribute(i.name)}}}if(e===8||e===3){if(n.nodeValue!==l.nodeValue){n.nodeValue=l.nodeValue}}if(l instanceof HTMLInputElement&&n instanceof HTMLInputElement&&l.type!=="file"){let e=l.value;let t=n.value;a(l,n,"checked");a(l,n,"disabled");if(!l.hasAttribute("value")){n.value="";n.removeAttribute("value")}else if(e!==t){n.setAttribute("value",e);n.value=e}}else if(l instanceof HTMLOptionElement){a(l,n,"selected")}else if(l instanceof HTMLTextAreaElement&&n instanceof HTMLTextAreaElement){let e=l.value;let t=n.value;if(e!==t){n.value=e}if(n.firstChild&&n.firstChild.nodeValue!==e){n.firstChild.nodeValue=e}}}function a(e,t,l){if(e[l]!==t[l]){t[l]=e[l];if(e[l]){t.setAttribute(l,"")}else{t.removeAttribute(l)}}}function o(e,t,n){let l=[];let r=[];let o=[];let i=[];let d=n.head.strategy;let a=new Map;for(const f of e.children){a.set(f.outerHTML,f)}for(const u of t.children){let e=a.has(u.outerHTML);let t=n.head.shouldReAppend(u);let l=n.head.shouldPreserve(u);if(e||l){if(t){r.push(u)}else{a.delete(u.outerHTML);o.push(u)}}else{if(d==="append"){if(t){r.push(u);i.push(u)}}else{if(n.head.shouldRemove(u)!==false){r.push(u)}}}}i.push(...a.values());h("to append: ",i);for(const s of i){h("adding: ",s);let e=document.createRange().createContextualFragment(s.outerHTML);h(e);if(n.callbacks.beforeNodeAdded(e)!==false){t.appendChild(e);n.callbacks.afterNodeAdded(e);l.push(e)}}for(const c of r){if(n.callbacks.beforeNodeRemoved(c)!==false){t.removeChild(c);n.callbacks.afterNodeRemoved(c)}}n.head.afterHeadMorphed(t,{added:l,kept:o,removed:r})}function h(){}function f(){}function l(e,t,l){return{idMap:x(e,t),deadIds:new Set,callbacks:Object.assign({beforeNodeAdded:f,afterNodeAdded:f,beforeNodeMorphed:f,afterNodeMorphed:f,beforeNodeRemoved:f,afterNodeRemoved:f},l.callbacks),head:Object.assign({strategy:"merge",shouldPreserve:f,shouldReAppend:f,shouldRemove:f,afterHeadMorphed:f},l.head)}}function u(e,t,l){if(e==null||t==null){return false}if(e.nodeType===t.nodeType&&e.tagName===t.tagName){if(e.id!==""&&e.id===t.id){return true}else{return w(l,e,t)>0}}return false}function s(e,t){if(e==null||t==null){return false}return e.nodeType===t.nodeType&&e.tagName===t.tagName}function c(t,e,l){while(t!==e){let e=t;t=t.nextSibling;y(e,l)}k(l,e);return e.nextSibling}function p(l,e,n,r,o){let i=w(o,n,e);let t=null;if(i>0){let e=r;let t=0;while(e!=null){if(u(n,e,o)){return e}t+=w(o,e,l);if(t>i){return null}e=e.nextSibling}}return t}function m(e,t,l,n,r){let o=n;let i=l.nextSibling;let d=0;while(o!=null){if(w(r,o,e)>0){return null}if(s(l,o)){return o}if(s(i,o)){d++;i=i.nextSibling;if(d>=2){return null}}o=o.nextSibling}return o}function b(l){let n=new DOMParser;let e=l.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(e.match(/<\/html>/)||e.match(/<\/head>/)||e.match(/<\/body>/)){let e=n.parseFromString(l,"text/html");e.generatedByIdiomorph=true;return e}else{let e=n.parseFromString("<body><template>"+l+"</template></body>","text/html");let t=e.body.querySelector("template").content;t.generatedByIdiomorph=true;return t}}function g(e){if(e==null){const t=document.createElement("div");return t}else if(e.generatedByIdiomorph){return e}else if(e instanceof Node){const t=document.createElement("div");t.append(e);return t}else{const t=document.createElement("div");for(const l of[...e]){t.append(l)}return t}}function v(e,t,l){let n=[];let r=[];while(e!=null){n.push(e);e=e.previousSibling}while(n.length>0){let e=n.pop();r.push(e);t.parentElement.insertBefore(e,t)}r.push(t);while(l!=null){n.push(l);r.push(l);l=l.nextSibling}while(n.length>0){t.parentElement.insertBefore(n.pop(),t.nextSibling)}return r}function N(e,t,l){let n;n=e.firstChild;let r=n;let o=0;while(n){let e=S(n,t,l);if(e>o){r=n;o=e}n=n.nextSibling}return r}function S(e,t,l){if(s(e,t)){return.5+w(l,e,t)}return 0}function y(e,t){k(t,e);t.callbacks.beforeNodeRemoved(e);e.remove();t.callbacks.afterNodeRemoved(e)}function M(e,t){return!e.deadIds.has(t)}function A(e,t,l){let n=e.idMap.get(l)||i;return n.has(t)}function k(e,t){let l=e.idMap.get(t)||i;for(const n of l){e.deadIds.add(n)}}function w(e,t,l){let n=e.idMap.get(t)||i;let r=0;for(const o of n){if(M(e,o)&&A(e,o,l)){++r}}return r}function T(e,l){let n=e.parentElement;let t=e.querySelectorAll("[id]");for(const r of t){let t=r;while(t!==n&&t!=null){let e=l.get(t);if(e==null){e=new Set;l.set(t,e)}e.add(r.id);t=t.parentElement}}}function x(e,t){let l=new Map;T(e,l);T(t,l);return l}return{morph:e}}()});